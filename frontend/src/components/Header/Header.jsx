import React, {useEffect, useState} from 'react'
import styles from './header.module.scss'
import {FlexLayout} from '../ui/Layout/FlexLayout/FlexLayout'

import DSTULogo from '../../assets/dstu.svg'
import {Link, useLocation} from "react-router-dom";
import {useSelector} from "react-redux";
import cn from "classnames";
import {useGetEmployerOffersMutation, useGetStudentOffersMutation} from "../../store/api/resumeApi.js";

const Header = () => {
    const userData = useSelector(state => state.userState)
    const resumeState = useSelector((state) => state.resumeState)
    const [isVisible, setIsVisible] = useState(false)

    const [getStudentOffers, {error}] = useGetStudentOffersMutation()
    const [getEmployerOffers, {error2}] = useGetEmployerOffersMutation()

    const location = useLocation();

    useEffect(() => {
        const hideRoutes = [ "/register", "/register/", "/register/main", "/login", "/login/"]
        if (hideRoutes.includes(location.pathname)) setIsVisible(false)
        else setIsVisible(true)
    }, [location]);

    useEffect(() => {
        if (userData?.role === "employer") getEmployerOffers()
        else getStudentOffers()
    }, [userData?.role])

    return (
        <header className={cn(styles.container, isVisible && styles.visible)}>
            <div className={styles.inner}>
                <div className={styles.logo}>
                    <HeaderLogo />
                    <span>
                     PORKSCHE
                    </span>
                </div>

                <nav className={styles.desktop}>
                    {userData.role === "employer" &&
                        <Link className={styles.button} to={'/students'}>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="26" viewBox="0 0 20 26" fill="none">
                            <g clipPath="url(#clip0_1609_32885)">
                                <path
                                    d="M14.168 14.1328H5.27344C4.85156 14.1328 4.53516 14.4492 4.53516 14.8477C4.53516 15.2578 4.85156 15.5742 5.27344 15.5742H14.168C14.5781 15.5742 14.8828 15.2578 14.8828 14.8477C14.8828 14.4492 14.5781 14.1328 14.168 14.1328ZM14.168 18.2227H5.27344C4.85156 18.2227 4.53516 18.5508 4.53516 18.9609C4.53516 19.3594 4.85156 19.6641 5.27344 19.6641H14.168C14.5781 19.6641 14.8828 19.3594 14.8828 18.9609C14.8828 18.5508 14.5781 18.2227 14.168 18.2227ZM3.63281 25.125H16.0781C18.5039 25.125 19.7109 23.8945 19.7109 21.457V10.8164C19.7109 9.30469 19.5352 8.64844 18.5977 7.6875L12.1406 1.11328C11.25 0.199219 10.5117 0 9.19922 0H3.63281C1.21875 0 0 1.24219 0 3.67969V21.457C0 23.9062 1.20703 25.125 3.63281 25.125ZM3.71484 23.2383C2.50781 23.2383 1.88672 22.5938 1.88672 21.4219V3.71484C1.88672 2.55469 2.50781 1.88672 3.72656 1.88672H8.94141V8.69531C8.94141 10.1719 9.67969 10.8984 11.1445 10.8984H17.8242V21.4219C17.8242 22.5938 17.2031 23.2383 15.9844 23.2383H3.71484ZM11.3555 9.12891C10.8867 9.12891 10.7109 8.94141 10.7109 8.47266V2.25L17.4609 9.12891H11.3555Z"
                                    fill="var(--text-2-color)"/>
                            </g>
                            <defs>
                                <clipPath id="clip0_1609_32885">
                                    <rect width="19.7109" height="25.1367" fill="white"/>
                                </clipPath>
                            </defs>
                        </svg>
                        Резюме
                    </Link>
                    }
                    {userData.role !== "employer" &&
                        <Link className={styles.button} to={'/notify'}>
                            {resumeState?.offers?.length > 0 && <div className={styles.notify}>{resumeState?.offers?.length}</div>}
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25" fill="none">
                                <path d="M19.2813 13.6019V10.0159C19.2813 6.79885 17.0963 4.08885 14.1363 3.27385C13.8433 2.53585 13.1273 2.01585 12.2813 2.01585C11.4353 2.01585 10.7193 2.53585 10.4263 3.27385C7.46625 4.08985 5.28125 6.79885 5.28125 10.0159V13.6019L3.57425 15.3089C3.48121 15.4016 3.40742 15.5117 3.35714 15.6331C3.30685 15.7544 3.28106 15.8845 3.28125 16.0159V18.0159C3.28125 18.2811 3.38661 18.5354 3.57414 18.723C3.76168 18.9105 4.01603 19.0159 4.28125 19.0159H20.2813C20.5465 19.0159 20.8008 18.9105 20.9884 18.723C21.1759 18.5354 21.2813 18.2811 21.2813 18.0159V16.0159C21.2814 15.8845 21.2557 15.7544 21.2054 15.6331C21.1551 15.5117 21.0813 15.4016 20.9883 15.3089L19.2813 13.6019ZM19.2813 17.0159H5.28125V16.4298L6.98825 14.7228C7.08129 14.6301 7.15508 14.52 7.20537 14.3986C7.25565 14.2773 7.28144 14.1472 7.28125 14.0159V10.0159C7.28125 7.25885 9.52425 5.01585 12.2813 5.01585C15.0383 5.01585 17.2813 7.25885 17.2813 10.0159V14.0159C17.2813 14.2819 17.3863 14.5358 17.5743 14.7228L19.2813 16.4298V17.0159ZM12.2813 22.0159C12.9006 22.0166 13.5047 21.8244 14.0097 21.466C14.5148 21.1076 14.8956 20.6007 15.0993 20.0159H9.46325C9.66691 20.6007 10.0477 21.1076 10.5528 21.466C11.0578 21.8244 11.662 22.0166 12.2813 22.0159Z" fill="var(--text-2-color)"/>
                            </svg>
                            Уведомления
                        </Link>
                    }

                    <Link className={styles.button} to={'/profile'}>
                        <svg width="29" height="29" viewBox="0 0 29 29" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clipPath="url(#clip0_201_74084)">
                                <path
                                    d="M13.9992 26.0126C20.5383 26.0126 25.9523 20.5869 25.9523 14.0595C25.9523 7.52051 20.5266 2.10645 13.9875 2.10645C7.4602 2.10645 2.04614 7.52051 2.04614 14.0595C2.04614 20.5869 7.47192 26.0126 13.9992 26.0126ZM13.9992 24.0205C8.46802 24.0205 4.05005 19.5908 4.05005 14.0595C4.05005 8.52833 8.4563 4.09864 13.9875 4.09864C19.5188 4.09864 23.9602 8.52833 23.9602 14.0595C23.9602 19.5908 19.5305 24.0205 13.9992 24.0205ZM22.0149 21.7822L21.9797 21.6533C21.4055 19.9306 18.3117 18.0439 13.9992 18.0439C9.69848 18.0439 6.60473 19.9306 6.0188 21.6416L5.98364 21.7822C8.09302 23.8681 11.7141 25.0869 13.9992 25.0869C16.2961 25.0869 19.882 23.8798 22.0149 21.7822ZM13.9992 16.0517C16.2609 16.0752 18.0188 14.1533 18.0188 11.6338C18.0188 9.26661 16.2492 7.30957 13.9992 7.30957C11.7493 7.30957 9.96802 9.26661 9.97973 11.6338C9.99145 14.1533 11.7493 16.0283 13.9992 16.0517Z"
                                    fill="var(--text-2-color)" fillOpacity="0.85"/>
                            </g>
                            <defs>
                                <clipPath id="clip0_201_74084">
                                    <rect width="23.9062" height="23.918" fill="white"
                                          transform="translate(2.04614 2.10645)"/>
                                </clipPath>
                            </defs>
                        </svg>
                        Личный кабинет
                    </Link>
                    {/*{userData.role === "employer" && <Link className={styles.button} to={'/balance'}>*/}
                    {/*    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">*/}
                    {/*        <g clipPath="url(#clip0_1611_32979)">*/}
                    {/*            <path*/}
                    {/*                d="M11.9531 23.9062C18.4922 23.9062 23.9062 18.4805 23.9062 11.9531C23.9062 5.41406 18.4805 0 11.9414 0C5.41406 0 0 5.41406 0 11.9531C0 18.4805 5.42578 23.9062 11.9531 23.9062ZM11.9531 21.9141C6.42188 21.9141 2.00391 17.4844 2.00391 11.9531C2.00391 6.42188 6.41016 1.99219 11.9414 1.99219C17.4727 1.99219 21.9141 6.42188 21.9141 11.9531C21.9141 17.4844 17.4844 21.9141 11.9531 21.9141Z"*/}
                    {/*                fill="var(--text-2-color)"/>*/}
                    {/*            <path*/}
                    {/*                d="M9.96094 17.8125C10.4062 17.8125 10.7109 17.4961 10.7109 17.0391V15.8555H13.4531C13.793 15.8555 14.0156 15.6094 14.0156 15.2695C14.0156 14.9414 13.793 14.6953 13.4531 14.6953H10.7109V13.5469H12.7148C14.9062 13.5469 16.2891 12.0938 16.2891 10.0664C16.2891 8.05078 14.918 6.57422 12.7266 6.57422H9.94922C9.49219 6.57422 9.1875 6.89062 9.1875 7.35938V12.3984H8.14453C7.79297 12.3984 7.57031 12.6445 7.57031 12.9727C7.57031 13.3008 7.79297 13.5586 8.14453 13.5586H9.1875V14.6953H8.15625C7.81641 14.6953 7.58203 14.9414 7.58203 15.2695C7.58203 15.6094 7.81641 15.8555 8.15625 15.8555H9.1875V17.0391C9.1875 17.4961 9.51562 17.8125 9.96094 17.8125ZM10.7227 12.1758V7.98047H12.457C13.9805 7.98047 14.7539 8.78906 14.7539 10.0781C14.7539 11.3789 13.9688 12.1992 12.457 12.1992L10.7227 12.1758Z"*/}
                    {/*                fill="var(--text-2-color)"/>*/}
                    {/*        </g>*/}
                    {/*        <defs>*/}
                    {/*            <clipPath id="clip0_1611_32979">*/}
                    {/*                <rect width="23.9062" height="23.918" fill="white"/>*/}
                    {/*            </clipPath>*/}
                    {/*        </defs>*/}
                    {/*    </svg>*/}
                    {/*    Баланс: {userData?.balance}*/}
                    {/*</Link>}*/}

                    <button className={styles.button} onClick={() => {
                        localStorage.removeItem("token")
                        localStorage.removeItem("refresh_token")
                        window.location.reload()
                    }}>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M8.90039 7.55999C9.21039 3.95999 11.0604 2.48999 15.1104 2.48999H15.2404C19.7104 2.48999 21.5004 4.27999 21.5004 8.74999V15.27C21.5004 19.74 19.7104 21.53 15.2404 21.53H15.1104C11.0904 21.53 9.24039 20.08 8.91039 16.54" stroke="var(--text-2-color)" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                            <path d="M2 12H14.88" stroke="var(--text-2-color)" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                            <path d="M12.6504 8.6499L16.0004 11.9999L12.6504 15.3499" stroke="var(--text-2-color)" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                        </svg>
                    </button>
                </nav>
            </div>
        </header>
    )
}

export default Header

const HeaderLogo = () => (
<svg viewBox="0 0 800 950" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M716.694 290.294L652.988 233.047C641.669 222.803 627.056 217.697 611.828 217.697H606.169C605.866 217.697 567.222 183.744 539.434 159.469C531.072 152.163 518.006 158.11 518.006 169.216V234.556C518.006 234.619 468.788 303.863 468.788 303.863C425.722 322.319 401.113 343.853 377.734 377.753C309.166 372.8 229.925 414.175 176.984 489.756C126.128 562.35 112.119 651.375 135.594 710.331C122.225 715.603 110.05 723.853 100.172 734.641C82.1469 754.325 73.1594 780.941 75.5188 807.663C79.8188 856.35 122.266 894.485 172.159 894.485L435.044 894.535C448.613 894.535 459.653 905.575 459.653 919.144C459.653 932.735 470.672 943.753 484.263 943.753C497.853 943.753 508.872 932.735 508.872 919.144C508.872 880.756 479.422 849.116 441.928 845.635L441.256 845.266H172.156C147.534 845.266 126.619 826.847 124.544 803.335C123.378 790.138 127.613 777.544 136.466 767.875C143.884 759.775 153.584 754.769 164.231 753.335C194.772 784.713 231.406 797.063 236.347 797.063L395.022 796.181C408.597 796.106 419.563 785.078 419.563 771.503C419.563 757.872 408.513 746.825 394.884 746.825H333.434C333.434 746.825 366.775 718.485 382.341 702.438C382.522 702.25 382.659 702.069 382.822 701.885C393.481 691.406 401.309 678.056 404.95 663.047C408.469 646.728 407.497 627.528 398.609 607.231C388.309 586.735 369.628 571.188 347.053 565.091C338.641 563.21 284.216 562.26 284.216 562.26C277.422 562.26 271.913 556.75 271.913 549.956C271.913 543.163 277.422 537.653 284.216 537.653H324.206V537.694C324.719 537.685 323.691 537.653 324.206 537.653C372.928 537.653 415.6 570.672 428.016 615.497C428.05 615.6 428.1 615.719 428.134 615.822L474.119 782.5C476.328 790.503 483.609 796.047 491.913 796.047H542.613C556.203 796.047 567.222 785.028 567.222 771.438C567.222 757.847 556.203 746.828 542.613 746.828H518.003L517.972 599.388C580.172 568.322 616.441 520.178 616.441 426.91C616.441 388.919 616.441 353.081 616.441 353.081H693.344C704.663 353.081 717.091 345.728 719.953 334.747L724.044 315.091C726.381 306.103 723.581 296.569 716.694 290.294Z" fill="var(--text-color)"/>
<g clip-path="url(#clip0_47_172)">
<path fill-rule="evenodd" clip-rule="evenodd" d="M620.265 142.36L648.203 192.026C650.53 196.163 655.776 197.632 659.914 195.304C664.051 192.977 665.52 187.731 663.192 183.594L635.254 133.928C632.927 129.791 627.681 128.322 623.543 130.649C619.406 132.976 617.937 138.223 620.265 142.36Z" fill="#141414"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M418.168 328.556L505.093 321.532C532.476 319.323 557.509 305.241 573.606 282.992L624.701 212.389L605.903 178.972C604.464 176.414 601.827 174.767 598.903 174.596C595.969 174.431 593.164 175.759 591.437 178.138L539.688 249.661C528.996 264.423 512.388 273.766 494.22 275.238L406.174 282.352C403.245 282.593 400.648 284.291 399.265 286.884C397.892 289.471 397.931 292.581 399.37 295.139L418.168 328.556Z" fill="var(--text-color)"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M553.619 259.74L631.412 152.243C637.438 143.92 638.069 132.857 633.032 123.903C627.995 114.949 618.213 109.743 607.965 110.562L475.708 121.235C452.528 123.106 431.322 135.034 417.687 153.873C396.477 183.169 362.334 230.33 339.85 261.382C333.823 269.705 333.198 280.779 338.235 289.732C343.272 298.686 353.054 303.892 363.302 303.074C401.515 299.982 459.549 295.292 495.599 292.377C518.779 290.507 539.985 278.578 553.619 259.74Z" fill="var(--text-color)"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M338.166 264.049C333.764 271.985 333.72 281.705 338.239 289.74C343.276 298.694 353.058 303.899 363.306 303.081C401.519 299.989 459.553 295.299 495.604 292.385C518.783 290.515 539.989 278.586 553.624 259.747L631.416 152.25C637.442 143.927 638.073 132.864 633.036 123.91C628.517 115.876 620.187 110.866 611.118 110.508C610.619 111.42 610.051 112.305 609.431 113.167L531.633 220.654C517.998 239.493 496.798 251.431 473.618 253.302C437.568 256.216 379.534 260.906 341.315 263.988C340.257 264.07 339.206 264.096 338.166 264.049Z" fill="var(--text-color)"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M553.619 259.74L631.412 152.243C637.438 143.92 638.069 132.857 633.032 123.903C627.995 114.949 618.213 109.743 607.965 110.562L475.708 121.235C452.528 123.106 431.322 135.034 417.687 153.873C396.477 183.169 362.334 230.33 339.85 261.382C333.823 269.705 333.198 280.779 338.235 289.732C343.272 298.686 353.054 303.892 363.302 303.074C401.515 299.982 459.549 295.292 495.599 292.377C518.779 290.507 539.985 278.578 553.619 259.74ZM617.48 142.162L539.687 249.659C528.996 264.422 512.387 273.765 494.219 275.237C458.168 278.151 400.135 282.841 361.916 285.923C358.367 286.209 354.973 284.408 353.225 281.3C351.476 278.192 351.7 274.357 353.787 271.473L431.619 163.953C442.311 149.191 458.92 139.848 477.088 138.376L609.351 127.712C612.9 127.426 616.294 129.227 618.042 132.335C619.79 135.443 619.567 139.278 617.48 142.162Z" fill="var(--text-color)"/>
</g>
<defs>
<clipPath id="clip0_47_172">
<rect width="366.902" height="366.902" fill="white" transform="translate(260 179.883) rotate(-29.3587)"/>
</clipPath>
</defs>
</svg>



)